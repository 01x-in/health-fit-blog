---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blogs');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'blogs'>;

const post = Astro.props;
const { Content } = await post.render();

// Calculate reading time
const wordsPerMinute = 200;
const wordCount = post.body.split(/\s+/).length || 0;
const readingTime = Math.max(1, Math.ceil(wordCount / wordsPerMinute));

// Get category from slug path
const category = post.slug.split('/')[0];
const categoryColors: Record<string, { bg: string; text: string; accent: string }> = {
	health: { bg: 'bg-emerald-50', text: 'text-emerald-700', accent: 'border-emerald-500' },
	fitness: { bg: 'bg-blue-50', text: 'text-blue-700', accent: 'border-blue-500' },
};
const colors = categoryColors[category.toLowerCase()] || categoryColors.health;

// Format date
const formattedDate = post.data.pubDate.toLocaleDateString('en-US', {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});
---

<Layout title={post.data.title} description={post.data.description} fullWidth={true}>
	<article class="min-h-screen bg-gradient-to-b from-slate-50 to-white">
		<!-- Hero Section -->
		<header class="relative pt-12 pb-16 md:pt-20 md:pb-24">
			<div class="max-w-3xl mx-auto px-6">
				<!-- Category & Reading Time -->
				<div class="flex items-center gap-4 mb-8">
					<span class={`inline-flex items-center px-3 py-1.5 text-xs font-bold tracking-widest uppercase rounded-full ${colors.bg} ${colors.text}`}>
						{category}
					</span>
					<span class="text-slate-400 text-sm font-medium">
						{readingTime} min read
					</span>
				</div>

				<!-- Title -->
				<h1 class="font-serif text-4xl md:text-5xl lg:text-6xl font-bold text-slate-900 leading-[1.1] tracking-tight mb-6">
					{post.data.title}
				</h1>

				<!-- Description/Deck -->
				{post.data.description && (
					<p class="text-xl md:text-2xl text-slate-600 leading-relaxed font-light max-w-2xl">
						{post.data.description}
					</p>
				)}

				<!-- Meta Row -->
				<div class="flex flex-wrap items-center gap-x-6 gap-y-3 mt-10 pt-8 border-t border-slate-200">
					<time datetime={post.data.pubDate.toISOString()} class="text-slate-500 font-medium">
						{formattedDate}
					</time>

					{post.data.tags && post.data.tags.length > 0 && (
						<div class="flex flex-wrap gap-2">
							{post.data.tags.map((tag: string) => (
								<span class="px-2.5 py-1 text-xs font-medium text-slate-500 bg-slate-100 rounded-md hover:bg-slate-200 transition-colors cursor-default">
									#{tag}
								</span>
							))}
						</div>
					)}
				</div>
			</div>
		</header>

		<!-- Hero Image -->
		{post.data.heroImage && (
			<figure class="max-w-4xl mx-auto px-6 mb-16">
				<div class="relative aspect-[16/9] rounded-2xl overflow-hidden shadow-2xl shadow-slate-200/50">
					<img
						src={post.data.heroImage}
						alt={post.data.title}
						class="w-full h-full object-cover"
						loading="eager"
					/>
				</div>
			</figure>
		)}

		<!-- Article Body -->
		<div class="max-w-3xl mx-auto px-6 pb-20">
			<div class={`article-content prose prose-lg prose-slate max-w-none
				prose-headings:font-serif prose-headings:font-bold prose-headings:tracking-tight
				prose-h2:text-2xl prose-h2:md:text-3xl prose-h2:mt-16 prose-h2:mb-6 prose-h2:text-slate-900
				prose-h2:pl-5 prose-h2:border-l-4 ${colors.accent}
				prose-h3:text-xl prose-h3:mt-10 prose-h3:mb-4
				prose-p:text-slate-700 prose-p:leading-[1.8] prose-p:mb-6
				prose-a:text-teal-600 prose-a:font-medium prose-a:no-underline hover:prose-a:underline
				prose-strong:text-slate-900 prose-strong:font-semibold
				prose-blockquote:border-l-4 prose-blockquote:border-slate-300 prose-blockquote:pl-6
				prose-blockquote:italic prose-blockquote:text-slate-600 prose-blockquote:my-8
				prose-ul:my-6 prose-li:text-slate-700 prose-li:leading-relaxed
				prose-img:rounded-xl prose-img:shadow-lg
			`}>
				<Content />
			</div>

			<!-- Sources Section -->
			{post.data.sources && post.data.sources.length > 0 && (
				<footer class="mt-20 pt-10 border-t border-slate-200">
					<h3 class="text-sm font-bold uppercase tracking-widest text-slate-400 mb-6">
						Sources & Further Reading
					</h3>
					<ul class="space-y-4">
						{post.data.sources.map((source: { title: string; url: string }, index: number) => (
							<li class="group">
								<a
									href={source.url}
									target="_blank"
									rel="noopener noreferrer"
									class="flex items-start gap-4 p-4 -mx-4 rounded-lg hover:bg-slate-50 transition-colors"
								>
									<span class="flex-shrink-0 w-6 h-6 rounded-full bg-slate-100 text-slate-400 text-xs font-bold flex items-center justify-center group-hover:bg-teal-100 group-hover:text-teal-600 transition-colors">
										{index + 1}
									</span>
									<div class="flex-1 min-w-0">
										<span class="text-slate-700 font-medium group-hover:text-teal-600 transition-colors line-clamp-2">
											{source.title}
										</span>
										<span class="block text-sm text-slate-400 truncate mt-1">
											{new URL(source.url).hostname.replace('www.', '')}
										</span>
									</div>
									<svg class="flex-shrink-0 w-5 h-5 text-slate-300 group-hover:text-teal-500 transition-colors mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
									</svg>
								</a>
							</li>
						))}
					</ul>
				</footer>
			)}

			<!-- Bottom Navigation -->
			<nav class="mt-16 pt-10 border-t border-slate-200">
				<a
					href={import.meta.env.BASE_URL}
					class="inline-flex items-center gap-2 text-slate-500 hover:text-teal-600 font-medium transition-colors group"
				>
					<svg class="w-5 h-5 transform group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
					</svg>
					Back to all articles
				</a>
			</nav>
		</div>
	</article>
</Layout>

<style is:global>
	.article-content {
		font-family: 'Source Sans 3', system-ui, sans-serif;
	}

	.article-content h1,
	.article-content h2,
	.article-content h3,
	header h1 {
		font-family: 'Newsreader', Georgia, serif;
	}

	/* Smooth scroll for anchor links */
	html {
		scroll-behavior: smooth;
	}

	/* Selection styling */
	::selection {
		background-color: rgb(20 184 166 / 0.2);
	}

	/* Line clamp utility */
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
